# 2장 분해 전략
## 2.1 마이크로서비스 아키텍처란 무엇인가?
- 마이크로서비스 아키텍처는 관리성, 테스트성, 배포성이 높은 애플리케이션을 구축하는 아키텍처 스타일입니다. 

### 2.1.1 소프트웨어 아키텍처의 정의와 중요성 
#### 2.1.1.1 소프트웨어 아키텍처 정의 
> 컴퓨팅 시스템의 소프트웨어 아키텍처는 소프트웨어 엘리먼트와 그들 간의 관계, 
> 그리고 이 둘의 속성으로 구성된 시스템을 추론하는 데 필요한 구조의 집합이다.
- 업무와 지식을 분리

#### 2.1.1.2 소프트웨어 아키텍처의 4+1 뷰 모델
- 논리뷰: 개발자가 작성한 소프트웨어 엘리먼트, 객체 지향 언어에 상속, 연관, 의존 등의 클래스와 패키지의 관계
- 구현뷰: 빌드 시스템의 결과물, 모듈과 컴포넌트이상의 모듈로 구성된 실행/배포 가능단위로 구성됩니다.
- 프로세스뷰: 런타임 컴포넌트, 각 엘리먼트는 개별 프로세스고, IPC는 프로세스간의 관계
- 배포뷰: 프로세스가 머신에 매핑되는 방법

#### 2.1.1.3 아키텍처의 중요성
- 애플리케이션이 해야 할 일을 정의한 기능 요건
- 이른바 ~성으로 끝나는 서비스 품질 요건입니다. (비기능)

#### 2.1.2 아키텍처 스타일 개요
- 계층화 아키텍처 스타일: 소프트웨어 엘리먼트를 계층별로 구성하는 계층화 아키텍처
- 육각형 아키텍처 스타일: 논리 뷰를 비지니스 로직 중심으로 구성하는 계층화 아키텍처 스타일의 대안 

### 2.1.3 마이크로서비스 아키텍처는 일종의 아키텍처 스타일이다. 
- 모놀리식 아키텍처: 애플리케이션을 실행/배포 가능한 단일 컴포넌트로 구성된다. 
- 마이크로서비스 아키텍처: 애플리케이션을 느슨하게 결합된, 독립적으로 배포 가능한 여러 서비스로 구성한다. 

#### 2.1.3.1 서비스란 무엇인가?
- 서비스는 어떤 기능이 구현되어 단독 배포가 가능한 소프트웨어 컴포넌트입니다. 
- 커맨드: 명령
- 쿼리: 조회
- 이벤트: 클라이언트가 소비하는 서비스

#### 2.1.3.2 느슨한 결합
- 느슨하게 결합된 서비스는 마이크로서비스 아키텍처의 주요 특성중 하나.

#### 2.1.3.3 공유 라이브러리 역할
- 서비스 코드 중복을 줄이기 위해 의도치 않은 서비스 결합도를 유발하지 않도록 조심해야 합니다. 

#### 2.1.3.4 서비스 규모는 별로 중요하지 않다.

## 2.2 마이크로서비스 아키텍처 정의 
- 1단계는 애플리케이션 요건을 핵심 요청으로 추출하는 것이다. 
- 2단계는 어떻게 여러 서비스로 분해할지 결정하는 것이다. 
- 3단계는 서비스별로 API를 정의하는 일이다.

### 2.2.1 시스템 작업 식별
- 애플리케이션 아키텍처를 정의하는 첫 단추는 시스템 작업을 정의하는 일이다. 
- 1단계는 시스템 작업을 기술하기 위해 필요한 보케블러를 제공하는 핵심 클래스로 구성된 고수준의 도메인 모델을 생성
- 2단계는 시스템 작업 식별 후 그 동작을 도메인 모델 관점에서 기술

#### 2.2.1.1 고수준 도메인 모델 생성
- Consumer: 주문을하는 소비자
- Order: 소비자가 한 주문
- OrderLineItem: Order 품목
- DeliveryInfo: 주문을 배달할 시간/장소
- Restaurant: 음식점
- MenuItem: 음식적 메뉴
- Courier: 배달원
- Address: 주소
- Location: 배달원 위치

#### 2.2.1.2 시스템 작업 정의
| 엑터| 스토리     | 커맨드                     | 설명             |
|--|---------|-------------------------|----------------|
|Consumer| 주문생성    | createOrder()           | 주문을 생성한다       |
|Restaurant| 주문접수    | acceptOrder()           | 주문을 접수한다       |
|Restaurant| 주문픽업준비됨 | noteOrderReadyForPickup() | 음식이 픽업가능함을 알림  |
|Courier| 위치업데이트  | noteUpdatedLocation()   | 배달원의 위치를 업데이트한다 |
|Courier| 배달픽업    | noteDeliveryPickedUp()  | 음식을 배달원이 픽업했다  |
|Courier| 주문배달됨   | noteDeliveryDe;overed() | 배달완료되었다        |

### 2.2.2 서비스 정의: 비즈니스 능력 패턴별 분해
- 마이크로서비스 아키텍처를 구축하는 첫 번째 전략은 비지니스 능력에 따라 분해하는 것입니다.

#### 2.2.2.1 비지니스 능력은 곹 조직이 하는 일이다.
- 비지니스 능력을 보면 그 조직의 비지니스가 무엇인지 알 수 있습니다. 
- 조직의 비지니스에 대한 방법은 달라질 수 있지만 비지니스 능력을 크게 달라지지 않는다.

#### 2.2.2.2 비지니스 능력 식별
- 한 조직의 비지니스 능력은 조직의 목표, 구조, 비지니스 프로세스를 분석하여 식별합니다. 
- 비지니스 능력은 보통 특정 비즈니스 객체에 집중하며, 여러 개의 하위 능력으로 분해할 수 있습니다. 

#### 2.2.2.3 비즈니스 능력을 여러 서비스로
- 비즈니스 능력을 식별한 후 능력에 따라 또는 연관된 능력 그룹에 따라 서비스를 정의합니다. 

### 2.2.3 서비스 정의: 하위 도메인 패턴별 분해
- DDD는 도메인을 구성하는 각 하위 도메인마다 도메인 모델을 따로 정의합니다. 
- 하위 도메인은 비지니스 능력과 같은 방법으로 식별하므로 십중팔구 비지니스 능력과 유사한 하위 도메인이 도출됩니다.

### 2.2.4 분해 지침
#### 2.2.4.1 단일 책임 원칙
- 클래스는 오직 하나의 변경 사유를 가져야 한다. 

#### 2.2.4.2 공동 폐쇄 원칙
- 패키지의 클래스들은 동일한 유형의 변경에 대해 닫혀 있어야 한다. 
- 패키지에 영향을 주는 변경은 그 패키지에 속한 모든 클래스에 영향을 끼친다.

### 2.2.5 서비스 분해의 장애물
- 비지니스 능력과 하위 도메인별로 서비스를 정의해서 마이크로서비스 구축하는데 장애 요소
  - 네트워크 지연: 서비스를 여러개로 나누면서 서비스 간 통신 횟수가 증가
  - 동기 IPC로 인한 가용성 저하
  - 여러 서비스에 걸쳐 데이터 일관성 유지 (사가 패턴)
  - 일관된 데이터 뷰 확보
  - 만능 클래스는 분해의 걸림돌

### 2.2.6 서비스 API 정의 
- 서비스 이벤트는 주로 타 서비스와 협동하기 위해 발행됩니다. 
- 서비스 API를 정의하려면 우선 각각의 시스템 작업을 서비스로 매핑한 후 서비스가 서로 협동해야 할지 파악해한다. 
- 협동이 필요한 서비스가 있으며 어느 서비스가 어는 API를 타 서비스에 제공할지도 정해야 한다. 

