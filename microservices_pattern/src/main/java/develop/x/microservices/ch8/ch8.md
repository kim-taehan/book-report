# 8장 외부 API 패턴

## 8.1 외부 API 설계 이슈
- 클라이언트가 서비스를 직접 호출하는 방식은 마이크로서비스에서는 잘 사용되지 않는다. 
  - 서비스 API가 나눠져 있어 클라이언트가 필요한 데이터를 가져오려면 여러 번 호출해야 된서 UX 가 나빠진다. 
  - 클라이언트가 서비스 및 API를 알아야 하는 구조라서 캡슐화가 되지 않는다. 
  - 클라이언트가 사용하기 어려운 IPC를 서비스에서 사용중일 수 있다. 

## 8.2 API 게이트웨이 패턴 
- 마이크로서비스 애플리케이션에 외부 API 클라이언ㅌ의 진입점에 해당하는 서비스를 구현한다. 

### 8.2.1 API 게이트웨이 패턴 개요
- API 게이트웨이는 방화벽 외부의 클라이언트가 애플리케이션에 API 요청을 하는 단일 창구 역할을 하는 서비스 
- 퍼사드처럼 내부 애플리케이션 아키텍처를 캡슐화하고 자신의 클라인트에는 API를 제공한다. 
- 인증, 모니터링, 사용량 제한 등의 부수적인 일도 담당한다. 

#### 요청 라우팅
- 요청이 들어오면 API 게이트웨이는 라우팅 맵을 찾아보고 어떤 서비스로 보낼지 결정한다.
- 리버스 프록시와 동일

#### API 조합
- 클라이언트가 한번의 요청으로 필요한 데이터를 조회할 수 있도록 API 를 조합하는 역할도 수행한다. 

#### 프로토콜 변환 
- 애플리케이션 내부에서 REST와 gRPC를 혼용하는 경우에도 클라이언트에 REST API 를 제공할 수 있다. 

#### 클라이언트마다 적합한 API를 제공한다.

#### 엣지 기능 구현 
- 인증, 인가, 사용량 제한, 캐싱, 지표 수집, 요청 로깅 등의 엣지 기능도 제공

#### 프런트엔드 패턴을 위한 백엔드 
- 각 클라이언트마다 API 게이트웨이를 따로 두는 BFF 패턴을 적용하는 것도 방법
- 단 중복된 코드를 관리하는 공통 계층을 위해 동일한 기술 스택을 적용하는 것이 좋다. 

### 8.2.2 API 게이트웨이 장단점
- 장점
  - 애플리케이션 내부 구조를 캡슐화 한다. 
  - 클라이언트-애플리케이션 요청 횟수가 줄어들어 클라이언트 코드도 단순해진다.
- 단점
  - 개발, 배포, 관리를 해야 하는 컴포넌트가 늘어난다. 
  - 개발 병목 지점이 될 수 있다. 
  - BFF 패턴을 쓰지 않는 경우 전체 기능이 다운될 수 있다. 

### 8.2.4 API 게이트웨이 설계 이슈
- 성능성과 확장성 
- 리엑티브 프로그래밍 이용한 관리 가능한 코드
- 부분 실패 처리