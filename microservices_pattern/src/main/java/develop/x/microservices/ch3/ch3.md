# 3장 프로세스 간 통신

## 3.1 마이크로서비스 아키텍처 IPC 개요
- HTTP 기반 REST나 GRPC 등 동기 요청/응답 기반의 통신 매커니즘도 있고, AMQP, STOMP 등 비동기 메시지 기반은 통신 매커니즘도 있다.
- 메시지 포맷 역시 JSON, XML 처럼 읽을 수 있는 텍스트 포맷부터 아부로, 프로토콜 버퍼처럼 이진 포맷도 존재한다.

### 3.1.1 상호 작용 스타일 
- 클라이언트/서비스 상호 작용 스타일은 다양하지만 두 가지 기준으로 분류할 수 있다.
- 일대일/일대다
  - 일대일: 각 클라이언트 요청은 정확히 한 서비스가 처리
  - 일대다: 각 클라이언트 요청을 여러 서비스가 협도하여 처리
- 동기/비동기
  - 동기: 클라이언트는 응답을 대기한다.
  - 비동기: 클라이언트 블로킹하지 않고, 응답을 대기하지 않는다.
- 일대일 상호 작용
  - 요청/응답: 클라이언트는 서비스에 요청을 하고 응답을 기다립니다.
  - 비동기요청/응답: 클라이언트는 서비스에 요청을 하고, 서비스는 비동기적으로 응답합니다. 
  - 단방향 알림: 클라이언트 서비스에 일방적으로 요청만 합니다.
- 일대다 상호작용
  - 발행/구독: 클라이언트는 알림 메시지를 발생하고, 여기에 관심 있는 0개 이상의 서비스가 메시지를 소비한다.
  - 발행/비동기 응답: 클라이언트는 알림 메시지를 발생하고, 주어진 시간 동안 관련 서비스가 응답하길 기다립니다.

### 3.1.2 마이크로서비스 API 정의 
- api 와 인터페이스는 소프트웨어 개발의 핵심이다. 애플리케이션은 여러 모듈로 구성되면, 각 모듈마다 자신의 클라이언트가 호출하는 작업이 정의된 인터페이스가 있다.
- 마이크로서비스 아키텍처에서는 api와 인터페이스가 둘 다 중요합니다. 서비스 api는 서비스와 클라이언트간의 약속이다. 

### 3.1.3 API 발전시키기
- 마이크로서비스은 클라이언트를 다른 서비스 팀이 개발한 경우가 대부분이기 때문에 서비스 API를 변경하기가 어렵다.

#### 3.1.3.1 시맨틱 버저닝 
- MAJOR: 하위 호환되지 않는 변경분을 API 적용시
- MINOR: 하위 호환되는 변경분을 API 적용시
- PATCH: 하위 호환되는 오류 수정시

#### 3.1.3.2 하위 호환되는 소규모 변경
- 요청 속성이 누락되어도 서비스는 기본값을 제공하고, 서비스가 필요한 것보다 더 많은 속성을 응답하더라도 클라이언트는 무시해야 한다.

#### 3.1.3.3 중대한 대규모 변경
- 기존 버전과 호환이 안 되는 변경을 API에 적용해야 할 때가 있습니다. 
- 일시에 클라이언트를 강제로 업그레이드 하는 것은 불가하므로 일정 기간 동안 신구 버전 API를 모두 지원해야 한다.

### 3.1.3 메시지 포맷
- IPC의 핵심은 메시지 교환입니다. IPC 효율, API 사용성, 발전성에 영향을 미친다. 
- 텍스트 메시지 포맷
  - JSON, XML 등 텍스트 기반 포맷은 읽을 수 있고 자기 서술적이라는 장점이 있습니다. 
  - 단점은 메시지 길다는 점과 텍스트 파싱하는 오버헤드가 존재한다.
- 이진 메시지 포맷
  - 프로토콜 버퍼와 아브로가 유명하며, 이들은 메시지 구조 정의필요한 타입 IDL을 제공하며, 컴파일러는 메시지를 직렬화/역직렬화 하는 코드를 생성한다. 
  - 따라서 서비스를 API 우선 접근 방식으로 설계 된다. 

## 3.2 동기 RPI 패턴 응용 통신
